<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style6.css">
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
<script>
  
  //json æ ¼å¼
  const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';
  const cities = [];
  //å…¨åŸŸwindowç‰©ä»¶çš„æ–¹æ³•ï¼Œå®ƒæœƒè¢«ç”¨ä¾†åŸ·è¡Œé€å‡ºRequest(è¦æ±‚)çš„å·¥ä½œï¼Œå¦‚æœæˆåŠŸå¾—åˆ°å›æ‡‰çš„è©±ï¼Œå®ƒæœƒå›å‚³ä¸€å€‹å¸¶æœ‰Response(å›æ‡‰)ç‰©ä»¶çš„å·²å¯¦ç¾Promiseç‰©ä»¶ã€‚
  fetch(endpoint)  //è‹¥æˆåŠŸå–å¾—(fetch)å›æ‡‰ then(è™•ç†???)
    //.then(response => response.json() )
    .then(function(response) { 
      return response.json(); 
    })
    .then(function(data) {
      //å±•é–‹(spread)é‹ç®—ç¬¦ï¼Œè‹¥æ²’æœ‰ ... å°‡dataåŠ é€²cities é™£åˆ—ä¸­[arr[1000],1,2,3] 
      //...data æœ‰æ‹·è²ä¹‹æ„
      cities.push(...data);
    })
  function findMatches(wordToMatch,cities) {
    //éæ¿¾å‡ºè¼¸å…¥wordToMatch ="XXX"  çš„åŸå¸‚æˆ–å·
    return cities.filter(function(place) {
      //æ˜¯å¦åŸå¸‚æˆ–å·è¢«æœå°‹
      //gi æ˜¯ flag
      const regex = new RegExp(wordToMatch, 'gi');
      //cityã€state æ˜¯ jsonè£¡å…¶ä¸­å±¬æ€§
      return place.city.match(regex) || place.state.match(regex)
    });
  }

  function numberWithCommas(x) {
    //æ¯ä¸‰å€‹æ•¸å­—å°±ä¸€å€‹é€—è™Ÿ12,345,678   \d æ¯”å°æ•¸å­—ç¬¦è™Ÿ g å…¨åŸŸ
  return x.toString().replace(/\B(?= (\d{3})+(?!\d) )/g, ',');
  }

  function displayMatches() {
    //this.value æ˜¯ è¼¸å…¥çš„å–®å­—
    const matchArray = findMatches(this.value, cities);
    const html = matchArray.map(place => {
      const regex = new RegExp(this.value, 'gi');
      //æŠŠä»–highlightèµ·ä¾†
      const cityName = place.city.replace(regex, `<span class="hl">${this.value}</span>`);
      const stateName = place.state.replace(regex, `<span class="hl">${this.value}</span>`);
      //mapå‡ºä¾†æ˜¯é™£åˆ—[<li></li>,<li></li>,<li></li>,...]
      return `
        <li>
          <span class="name">${cityName}, ${stateName}</span>
          <span class="population">${numberWithCommas(place.population)}</span>
        </li>
      `;
    }).join(''); //æŠŠé€—é»è®Šæˆç©º
    suggestions.innerHTML = html;
  }

  const searchInput = document.querySelector(".search");
  const suggestions = document.querySelector(".suggestions");
  //change ç›¸ç•¶åœ¨ html ä½¿ç”¨ onchange
  searchInput.addEventListener("change",displayMatches);
  //éµç›¤æ‰“äº†å°±é¡¯ç¤º
  searchInput.addEventListener("keyup",displayMatches);

  
</script>
  </body>
</html>